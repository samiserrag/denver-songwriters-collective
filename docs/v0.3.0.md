# v0.3.0 Release Notes

## Summary

Verification system for Open Mic Directory — community-driven corrections with admin review.

## User-Facing Changes

- **"Report a Change" form** on open mic detail pages (anonymous submissions allowed)
- **"Verified X days ago" / "Not yet verified" badges** on open mic listings
- **Admin verification dashboard** at `/dashboard/admin/verifications`

## Technical Changes

### Migration

`supabase/migrations/20251216000001_v030_verification_system.sql`

### New Table: `change_reports`

```sql
CREATE TABLE change_reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  event_id UUID REFERENCES events(id) ON DELETE CASCADE,
  field_name VARCHAR(50) NOT NULL,
  proposed_value VARCHAR(500) NOT NULL,
  notes TEXT,
  reporter_id UUID REFERENCES profiles(id),
  reporter_email VARCHAR(255),
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  reviewed_by UUID REFERENCES profiles(id),
  reviewed_at TIMESTAMPTZ,
  admin_notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### New Columns on `events`

- `last_verified_at TIMESTAMPTZ` — when the event was last verified
- `verified_by UUID` — admin who verified (references `profiles.id`)

### API Routes

| Method | Route | Purpose |
|--------|-------|---------|
| POST | `/api/change-reports` | Submit a change report |
| PATCH | `/api/admin/change-reports/[id]` | Approve/reject a report (admin) |

## Files Created/Modified

### New Files

- `supabase/migrations/20251216000001_v030_verification_system.sql`
- `web/src/app/api/change-reports/route.ts`
- `web/src/app/api/admin/change-reports/[id]/route.ts`
- `web/src/app/(protected)/dashboard/admin/verifications/page.tsx`
- `web/src/components/events/ReportChangeForm.tsx`
- `web/src/components/admin/ChangeReportsTable.tsx`

### Modified Files

- `web/src/app/open-mics/[slug]/page.tsx` — added verification badge and report form
- `web/src/lib/supabase/database.types.ts` — regenerated with new types

## Database Schema

### Indexes

```sql
CREATE INDEX idx_change_reports_event_id ON change_reports(event_id);
CREATE INDEX idx_change_reports_status ON change_reports(status);
CREATE INDEX idx_change_reports_created_at ON change_reports(created_at);
CREATE INDEX idx_events_last_verified_at ON events(last_verified_at);
CREATE INDEX idx_events_verified_by ON events(verified_by);
```

## RLS Policies

| Policy Name | Operation | Applies To | Condition |
|-------------|-----------|------------|-----------|
| Anyone can submit change reports | INSERT | public | `true` |
| Users can view their own change reports | SELECT | authenticated | `reporter_id = auth.uid()` |
| Admins can view all change reports | SELECT | authenticated | `is_admin()` |
| Admins can update change reports | UPDATE | authenticated | `is_admin()` |
| Admins can delete change reports | DELETE | authenticated | `is_admin()` |

## Quality Gate

- **Lint**: 0 errors
- **Tests**: 4 passed
- **Lighthouse**: No regression
